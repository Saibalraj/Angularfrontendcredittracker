<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link rel="stylesheet" href="forgot-password.css">
</head>
<body>
<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Back Button -->
    <button class="back-btn" (click)="goBack()">
      <i class="icon">‚Üê</i> Back to Login
    </button>

    <!-- Header -->
    <div class="header">
      <div class="logo">üîí</div>
      <h1>Forgot Password?</h1>
      <p class="subtitle">Enter your email to receive a verification code</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <span class="step-label">Enter Email</span>
      </div>
      <div class="step-connector" [class.completed]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <span class="step-label">Verify OTP</span>
      </div>
      <div class="step-connector" [class.completed]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <div class="step-number">3</div>
        <span class="step-label">New Password</span>
      </div>
    </div>

    <!-- Step 1: Email Input -->
    <div *ngIf="currentStep === 1" class="step-content">
      <form (ngSubmit)="sendOTP()" #emailForm="ngForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="email"
            #emailInput="ngModel"
            required
            email
            placeholder="Enter your registered email"
            [class.error]="emailInput.invalid && emailInput.touched"
          />
          <div *ngIf="emailInput.invalid && emailInput.touched" class="error-message">
            <span *ngIf="emailInput.errors?.['required']">Email is required</span>
            <span *ngIf="emailInput.errors?.['email']">Please enter a valid email address</span>
          </div>
          <div *ngIf="emailError" class="error-message">
            {{ emailError }}
          </div>
        </div>

        <button
          type="submit"
          class="submit-btn"
          [disabled]="emailForm.invalid || isLoading"
        >
          <span *ngIf="!isLoading">Send Verification Code</span>
          <span *ngIf="isLoading" class="loading">
            <i class="icon">‚è≥</i> Sending...
          </span>
        </button>
      </form>

      <div class="info-box">
        <i class="icon">üí°</i>
        <p>We'll send a 6-digit verification code to your email address.</p>
      </div>
    </div>

    <!-- Step 2: OTP Verification -->
    <div *ngIf="currentStep === 2" class="step-content">
      <div class="otp-info">
        <p>We sent a verification code to <strong>{{ email }}</strong></p>
        <button class="resend-btn" (click)="resendOTP()" [disabled]="canResendOTP">
          <span *ngIf="!canResendOTP">Resend code in {{ countdown }}s</span>
          <span *ngIf="canResendOTP">Resend code</span>
        </button>
      </div>

      <form (ngSubmit)="verifyOTP()" #otpForm="ngForm">
        <div class="form-group">
          <label for="otp">Enter 6-digit code</label>
          <div class="otp-inputs">
            <input
              *ngFor="let i of [0,1,2,3,4,5]; let idx = index"
              type="text"
              maxlength="1"
              [(ngModel)]="otpArray[idx]"
              [name]="'otp' + idx"
              (input)="onOtpInput($event, idx)"
              (keydown)="onOtpKeyDown($event, idx)"
              (paste)="onOtpPaste($event)"
              class="otp-digit"
              [class.error]="otpError"
            />
          </div>
          <div *ngIf="otpError" class="error-message">
            {{ otpError }}
          </div>
          <div *ngIf="attemptsRemaining > 0" class="attempts-warning">
            {{ attemptsRemaining }} attempts remaining
          </div>
        </div>

        <button
          type="submit"
          class="submit-btn"
          [disabled]="!isOtpComplete() || isLoading"
        >
          <span *ngIf="!isLoading">Verify Code</span>
          <span *ngIf="isLoading" class="loading">
            <i class="icon">‚è≥</i> Verifying...
          </span>
        </button>
      </form>

      <div class="info-box">
        <i class="icon">‚è∞</i>
        <p>Code expires in 10 minutes. Check your spam folder if you don't see it.</p>
      </div>
    </div>

    <!-- Step 3: New Password -->
    <div *ngIf="currentStep === 3" class="step-content">
      <form (ngSubmit)="resetPassword()" #passwordForm="ngForm">
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            [(ngModel)]="newPassword"
            #newPasswordInput="ngModel"
            required
            minlength="6"
            placeholder="Enter new password"
            [class.error]="newPasswordInput.invalid && newPasswordInput.touched"
          />
          <div *ngIf="newPasswordInput.invalid && newPasswordInput.touched" class="error-message">
            <span *ngIf="newPasswordInput.errors?.['required']">Password is required</span>
            <span *ngIf="newPasswordInput.errors?.['minlength']">Password must be at least 6 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            #confirmPasswordInput="ngModel"
            required
            placeholder="Confirm new password"
            [class.error]="(confirmPasswordInput.invalid && confirmPasswordInput.touched) || passwordMismatch"
          />
          <div *ngIf="confirmPasswordInput.invalid && confirmPasswordInput.touched" class="error-message">
            <span *ngIf="confirmPasswordInput.errors?.['required']">Please confirm your password</span>
          </div>
          <div *ngIf="passwordMismatch && confirmPasswordInput.touched" class="error-message">
            Passwords do not match
          </div>
        </div>

        <div class="password-strength" *ngIf="newPassword">
          <div class="strength-bar">
            <div class="strength-fill" [ngClass]="getPasswordStrengthClass()"></div>
          </div>
          <span class="strength-text">{{ getPasswordStrengthText() }}</span>
        </div>

        <button
          type="submit"
          class="submit-btn"
          [disabled]="passwordForm.invalid || passwordMismatch || isLoading"
        >
          <span *ngIf="!isLoading">Reset Password</span>
          <span *ngIf="isLoading" class="loading">
            <i class="icon">‚è≥</i> Resetting...
          </span>
        </button>
      </form>
    </div>

    <!-- Success Message -->
    <div *ngIf="currentStep === 4" class="success-content">
      <div class="success-icon">‚úÖ</div>
      <h2>Password Reset Successful!</h2>
      <p>Your password has been reset successfully. You can now login with your new password.</p>
      <button class="login-btn" (click)="goToLogin()">
        Go to Login
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message global-error">
      <i class="icon">‚ö†Ô∏è</i>
      {{ errorMessage }}
      <button class="close-error" (click)="clearError()">√ó</button>
    </div>
  </div>
</div>
</body>
</html>
